<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="https://lucide.dev/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VBE AI PROMPT BUILDER v3.0</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Config & Styles -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            vbe: {
              red: '#ff0000',
              redhover: '#cc0000',
              dark: '#050505',
              panel: '#0f0f0f',
              border: '#222222',
              text: '#e5e5e5',
              muted: '#666666',
              telegram: '#229ED9'
            }
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
  <style>
    body {
      background-color: #050505;
      color: #e5e5e5;
      background-image: 
        linear-gradient(rgba(10, 10, 10, 0.8), rgba(10, 10, 10, 0.95)),
        url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23151515' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }
    
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #0a0a0a; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; border: 1px solid #000; }
    ::-webkit-scrollbar-thumb:hover { background: #ff0000; }

    .crt-line {
      background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
      background-size: 100% 4px;
      position: fixed; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 9999; opacity: 0.15;
    }
    
    .btn-selected {
      background-color: #ff0000 !important;
      color: white !important;
      border-color: #ff0000 !important;
      box-shadow: 0 0 15px rgba(255,0,0,0.3);
    }
  </style>
</head>
<body>

  <div class="crt-line"></div>

  <div class="min-h-screen p-4 md:p-8 font-sans selection:bg-vbe-red selection:text-white">
    <div class="max-w-5xl mx-auto space-y-8">
      
      <!-- Header -->
      <header className="flex flex-col md:flex-row items-start md:items-center justify-between border-b border-vbe-border pb-6 gap-4">
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between w-full border-b border-vbe-border pb-6 gap-4">
          <div>
            <h1 class="text-3xl md:text-5xl font-black italic tracking-tighter text-white flex items-center gap-3">
              <i data-lucide="flame" class="text-vbe-red w-8 h-8 md:w-12 md:h-12 animate-pulse-slow"></i>
              VBE <span class="text-vbe-red">PROMPT</span>
              <span class="text-sm md:text-lg not-italic font-mono font-normal text-vbe-muted self-end mb-1 opacity-50">v3.0</span>
            </h1>
            <p id="subtitle" class="text-vbe-muted font-mono text-xs md:text-sm mt-2 ml-1 uppercase">
              /// PROFESSIONAL GRADE PROMPT ENGINEERING SYSTEM
            </p>
          </div>
          <div class="flex flex-col items-end gap-2">
            
            <!-- Telegram Button -->
            <a href="https://t.me/VBEvlog" target="_blank" class="flex items-center gap-2 px-3 py-1.5 bg-vbe-telegram/10 border border-vbe-telegram/30 hover:bg-vbe-telegram/20 hover:border-vbe-telegram hover:text-white rounded text-xs text-vbe-telegram transition-all font-mono font-bold cursor-pointer group mb-1">
              <i data-lucide="send" class="w-3 h-3 group-hover:translate-x-0.5 transition-transform"></i>
              <span>VBE CHANNEL</span>
            </a>

            <div class="flex items-center gap-2">
              <button id="lang-btn" class="flex items-center gap-2 px-3 py-1 bg-vbe-panel border border-vbe-border hover:border-vbe-red rounded text-xs text-vbe-text hover:text-white transition-all font-mono cursor-pointer">
                <i data-lucide="globe" class="w-3 h-3"></i>
                <span id="lang-en" class="text-white font-bold">EN</span>
                <span class="text-vbe-border">|</span>
                <span id="lang-ru" class="text-vbe-muted">RU</span>
              </button>
              <div id="status-text" class="px-3 py-1 bg-vbe-red/10 border border-vbe-red/30 rounded text-xs text-vbe-red font-mono animate-pulse">
                SYSTEM: ONLINE
              </div>
            </div>

          </div>
        </div>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Main Controls -->
        <div class="lg:col-span-8 space-y-6">
          
          <!-- Presets Section -->
          <div class="bg-vbe-panel border border-vbe-border rounded-lg p-4">
             <label id="lbl-presets" class="text-xs font-bold text-vbe-muted uppercase tracking-wider block mb-3 flex items-center gap-2">
                <i data-lucide="layers" class="w-3 h-3"></i> Quick Templates
             </label>
             <div id="presets-container" class="grid grid-cols-2 md:grid-cols-4 gap-2">
                <!-- Presets injected via JS -->
             </div>
          </div>

          <!-- View Input -->
          <div class="bg-vbe-panel p-5 rounded-lg border border-vbe-border relative group">
            <div class="flex justify-between items-center mb-3">
              <label id="lbl-view" class="text-sm font-bold text-vbe-muted uppercase tracking-wider flex items-center gap-2">
                <i data-lucide="terminal" class="w-4 h-4"></i> Scene Description (View)
              </label>
              <button id="btn-reset" class="text-xs text-vbe-muted hover:text-vbe-red transition-colors font-mono flex items-center gap-1 cursor-pointer">
                <i data-lucide="rotate-ccw" class="w-3 h-3"></i> <span id="lbl-reset">RESET</span>
              </button>
            </div>
            <textarea id="input-view" class="w-full h-32 bg-black/50 border border-vbe-border rounded p-4 text-white placeholder-vbe-border focus:border-vbe-red focus:outline-none focus:ring-1 focus:ring-vbe-red transition-all font-mono text-sm"></textarea>
            <div class="absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                <span class="text-[10px] text-vbe-muted font-mono">TYPE TO EDIT</span>
            </div>
          </div>

          <!-- Colors Input -->
          <div class="bg-vbe-panel p-5 rounded-lg border border-vbe-border">
            <label id="lbl-colors" class="text-sm font-bold text-vbe-muted uppercase tracking-wider block mb-3 flex items-center gap-2">
              <i data-lucide="zap" class="w-4 h-4"></i> Color Palette
            </label>
            <input type="text" id="input-colors" class="w-full bg-black/50 border border-vbe-border rounded p-3 text-white placeholder-vbe-border focus:border-vbe-red focus:outline-none font-mono text-sm" />
          </div>

          <!-- Dynamic Categories Container -->
          <div id="categories-container" class="space-y-4">
            <!-- Categories injected via JS -->
          </div>

          <!-- Build Button -->
          <button id="btn-generate" class="w-full py-4 bg-vbe-red hover:bg-vbe-redhover text-white font-black text-xl tracking-widest uppercase rounded shadow-[0_0_20px_rgba(255,0,0,0.4)] hover:shadow-[0_0_40px_rgba(255,0,0,0.6)] transition-all transform hover:-translate-y-1 active:translate-y-0 cursor-pointer flex items-center justify-center gap-3">
            <span>COMPILE PROMPT</span> <i data-lucide="chevron-right" class="w-6 h-6"></i>
          </button>
        </div>

        <!-- Sticky Sidebar Results -->
        <div class="lg:col-span-4">
          <div class="sticky top-8 space-y-4">
            
            <!-- Output -->
            <div class="bg-vbe-panel border border-vbe-border rounded-lg p-1 overflow-hidden shadow-lg shadow-black/50">
              <div class="bg-black/80 p-3 border-b border-vbe-border flex justify-between items-center">
                <span id="lbl-console" class="text-xs font-mono text-vbe-muted">OUTPUT CONSOLE</span>
                <button id="btn-copy" class="text-xs flex items-center gap-1 text-vbe-text hover:text-white transition-colors cursor-pointer hidden">
                  <i data-lucide="copy" class="w-3 h-3"></i> <span id="txt-copy">COPY</span>
                </button>
              </div>
              <textarea id="output-result" readonly placeholder="_" class="w-full h-[40vh] bg-black p-4 text-xs md:text-sm font-mono text-vbe-text resize-none focus:outline-none leading-relaxed"></textarea>
            </div>

            <!-- History Section -->
            <div class="bg-vbe-panel border border-vbe-border rounded-lg p-1 overflow-hidden">
                <div class="bg-black/80 p-2 border-b border-vbe-border flex justify-between items-center">
                  <span id="lbl-history" class="text-xs font-mono text-vbe-muted pl-2">HISTORY LOG</span>
                  <button id="btn-clear-history" class="text-[10px] text-vbe-muted hover:text-vbe-red pr-2 uppercase cursor-pointer">Clear</button>
                </div>
                <div id="history-container" class="max-h-[30vh] overflow-y-auto p-2 space-y-2 bg-black/40">
                    <!-- History items injected here -->
                    <div class="text-center py-4 text-vbe-muted text-xs italic opacity-50">No history yet</div>
                </div>
            </div>
            
            <div class="p-4 rounded border border-vbe-border bg-vbe-panel/50 text-xs text-vbe-muted font-mono">
              <p id="status-ready">STATUS: VBE_PROMPT_BUILDER_V3.0_READY</p>
              <p id="status-user">USER: ANONYMOUS</p>
              <p>CONNECTION: SECURE</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- DATA & CONSTANTS ---
    const UI_TEXT = {
      subtitle: { en: '/// PROFESSIONAL GRADE PROMPT ENGINEERING SYSTEM', ru: '/// ПРОФЕССИОНАЛЬНАЯ СИСТЕМА СОЗДАНИЯ ПРОМТОВ' },
      systemOnline: { en: 'SYSTEM: ONLINE', ru: 'СИСТЕМА: АКТИВНА' },
      sceneLabel: { en: 'Scene Description (View)', ru: 'Описание сцены (View)' },
      scenePlaceholder: { en: "Describe your scene here (e.g., 'A cyberpunk samurai in neon rain')...", ru: "Опиши сцену здесь (например, 'Киберпанк самурай под неоновым дождем')..." },
      colorLabel: { en: 'Color Palette', ru: 'Цветовая палитра' },
      colorPlaceholder: { en: 'e.g. Red and Black, Neon Blue...', ru: 'например: Красный и черный, Неоновый синий...' },
      generateBtn: { en: 'COMPILE PROMPT ///', ru: 'СОБРАТЬ ПРОМТ ///' },
      consoleTitle: { en: 'OUTPUT CONSOLE', ru: 'КОНСОЛЬ ВЫВОДА' },
      copy: { en: 'COPY', ru: 'КОПИРОВАТЬ' },
      copied: { en: 'COPIED', ru: 'СКОПИРОВАНО' },
      reset: { en: 'RESET', ru: 'СБРОС' },
      statusReady: { en: 'STATUS: VBE_PROMPT_BUILDER_V3.0_READY', ru: 'СТАТУС: VBE_PROMPT_BUILDER_V3.0_ГОТОВ' },
      userAnon: { en: 'USER: ANONYMOUS', ru: 'ПОЛЬЗОВАТЕЛЬ: АНОНИМ' },
      presetsLabel: { en: 'QUICK TEMPLATES', ru: 'БЫСТРЫЕ ШАБЛОНЫ' },
      historyLabel: { en: 'HISTORY LOG', ru: 'ИСТОРИЯ' },
    };

    const PRESETS = [
        {
            id: 'thumb', 
            name: { en: 'YouTube Thumbnail', ru: 'YouTube Превью' },
            icon: 'image',
            data: {
                view: "Close-up of a shocked face, pointing finger at glowing object, intense emotion, mystery background, arrows",
                colors: "Bright Yellow and Red, High Contrast",
                size: "1920x1080",
                composition: ["extreme close-up", "rule of thirds"],
                light: ["hard rim light", "studio lighting"],
                textures: ["high contrast", "glossy surfaces"],
                art: ["Realism"],
                extras: ["vignette"]
            }
        },
        {
            id: 'cinema',
            name: { en: 'Cinematic Movie', ru: 'Кинокадр' },
            icon: 'clapperboard',
            data: {
                view: "Wide shot of a dystopian city street at night, rain, neon signs reflection on wet asphalt, lonely figure walking",
                colors: "Teal and Orange, Dark tones",
                size: "--ar 21:9",
                composition: ["wide angle lens", "cinematic composition"],
                light: ["cinematic lighting", "volumetric lighting"],
                textures: ["hyperrealistic", "8k resolution, ultra detailed"],
                art: ["Realism", "Cyberpunk style"],
                extras: ["film grain", "chromatic aberration"]
            }
        },
        {
            id: 'logo',
            name: { en: 'Vector Logo', ru: 'Вектор Лого' },
            icon: 'hexagon',
            data: {
                view: "Minimalist vector logo of a wolf head, flat design, clean lines, white background, gradient fill",
                colors: "Gradient Purple to Blue",
                size: "1000x1000",
                composition: ["centered", "symmetrical composition"],
                light: ["soft diffused light"],
                textures: ["matte finish", "vector graphics"],
                art: ["Concept Art"],
                extras: []
            }
        },
        {
            id: 'iso',
            name: { en: '3D Game Asset', ru: '3D Изометрия' },
            icon: 'box',
            data: {
                view: "Isometric view of a magic potion shop, cute low poly style, floating islands, magical aura",
                colors: "Pastel Pink and Cyan",
                size: "1000x1000",
                composition: ["top-down view", "centered"],
                light: ["soft diffused light", "global illumination"],
                textures: ["Unreal Engine 5 render", "stylized 3d"],
                art: ["Concept Art"],
                extras: ["bokeh"]
            }
        }
    ];

    const CATEGORIES = [
      {
        id: 'size', title: { en: 'SIZE / FORMAT', ru: 'РАЗМЕР / ФОРМАТ' }, type: 'single',
        options: [
          { id: 'sq', label: { en: '1000x1000 (Square)', ru: '1000x1000 (Квадрат)' }, value: '1000x1000' },
          { id: 'p1', label: { en: '1080x1920 (Story)', ru: '1080x1920 (Сториз)' }, value: '1080x1920' },
          { id: 'l1', label: { en: '1920x1080 (HD)', ru: '1920x1080 (HD)' }, value: '1920x1080' },
          { id: 'mj1', label: { en: '--ar 16:9 (Midjourney)', ru: '--ar 16:9 (Горизонт)' }, value: '--ar 16:9' },
          { id: 'mj2', label: { en: '--ar 9:16 (Midjourney)', ru: '--ar 9:16 (Вертикаль)' }, value: '--ar 9:16' },
          { id: 'mj3', label: { en: '--ar 21:9 (Cinema)', ru: '--ar 21:9 (Кино)' }, value: '--ar 21:9' },
        ]
      },
      {
        id: 'composition', title: { en: 'COMPOSITION', ru: 'КОМПОЗИЦИЯ' }, type: 'multi',
        options: [
          { id: 'c1', label: { en: 'Close-Up', ru: 'Крупный план' }, value: 'extreme close-up' },
          { id: 'c2', label: { en: 'Medium Shot', ru: 'Средний план' }, value: 'medium shot' },
          { id: 'c3', label: { en: 'Wide Angle', ru: 'Широкий угол' }, value: 'wide angle lens' },
          { id: 'c4', label: { en: 'Top-Down', ru: 'Вид сверху' }, value: 'top-down view' },
          { id: 'c5', label: { en: 'Symmetry', ru: 'Симметрия' }, value: 'symmetrical composition' },
          { id: 'c6', label: { en: 'Dynamic', ru: 'Динамика' }, value: 'dynamic action shot' },
          { id: 'c7', label: { en: 'Rule of Thirds', ru: 'Правило третей' }, value: 'rule of thirds' },
          { id: 'c8', label: { en: 'Low Angle', ru: 'Нижний ракурс' }, value: 'low angle shot' },
          { id: 'c9', label: { en: 'Cinematic', ru: 'Кино-комп' }, value: 'cinematic composition' },
          { id: 'c10', label: { en: 'Centered', ru: 'Центр' }, value: 'centered' },
        ]
      },
      {
        id: 'light', title: { en: 'LIGHTING', ru: 'ОСВЕЩЕНИЕ' }, type: 'multi',
        options: [
          { id: 'l1', label: { en: 'Cinematic', ru: 'Кинематографичное' }, value: 'cinematic lighting' },
          { id: 'l2', label: { en: 'Neon / Cyber', ru: 'Неон / Кибер' }, value: 'neon lighting, cyberpunk atmosphere' },
          { id: 'l3', label: { en: 'Volumetric', ru: 'Объемный свет' }, value: 'volumetric lighting, god rays' },
          { id: 'l4', label: { en: 'Rembrandt', ru: 'Рембрандт' }, value: 'Rembrandt lighting' },
          { id: 'l5', label: { en: 'Soft Diffused', ru: 'Мягкий рассеянный' }, value: 'soft diffused light' },
          { id: 'l6', label: { en: 'Studio', ru: 'Студийный' }, value: 'studio lighting' },
          { id: 'l7', label: { en: 'Dark / Moody', ru: 'Мрачный / Темный' }, value: 'dark gloomy atmosphere' },
          { id: 'l8', label: { en: 'Golden Hour', ru: 'Золотой час' }, value: 'golden hour' },
          { id: 'l9', label: { en: 'Hard Rim', ru: 'Контровой (Жесткий)' }, value: 'hard rim light' },
          { id: 'l10', label: { en: 'Global Illum', ru: 'Глобальное' }, value: 'global illumination' },
        ]
      },
      {
        id: 'textures', title: { en: 'TEXTURES & RENDER', ru: 'ТЕКСТУРЫ И РЕНДЕР' }, type: 'multi',
        options: [
          { id: 't1', label: { en: '8K Ultra', ru: '8K Ультра' }, value: '8k resolution, ultra detailed' },
          { id: 't2', label: { en: 'Photorealism', ru: 'Фотореализм' }, value: 'hyperrealistic, photorealistic' },
          { id: 't3', label: { en: 'Unreal Engine 5', ru: 'Unreal Engine 5' }, value: 'Unreal Engine 5 render' },
          { id: 't4', label: { en: 'Octane Render', ru: 'Octane Render' }, value: 'Octane Render' },
          { id: 't5', label: { en: 'Ray Tracing', ru: 'Трассировка лучей' }, value: 'Ray Tracing, Global Illumination' },
          { id: 't6', label: { en: 'Matte', ru: 'Матовый' }, value: 'matte finish' },
          { id: 't7', label: { en: 'Glossy', ru: 'Глянцевый' }, value: 'glossy surfaces' },
          { id: 't8', label: { en: 'Vector', ru: 'Вектор' }, value: 'vector graphics' },
          { id: 't9', label: { en: 'Stylized 3D', ru: 'Стиль 3D' }, value: 'stylized 3d' },
          { id: 't10', label: { en: 'High Contrast', ru: 'Контраст' }, value: 'high contrast' },
        ]
      },
      {
        id: 'art', title: { en: 'ART STYLE', ru: 'ХУДОЖЕСТВЕННЫЙ СТИЛЬ' }, type: 'multi',
        options: [
          { id: 'a1', label: { en: 'Realism', ru: 'Реализм' }, value: 'Realism' },
          { id: 'a2', label: { en: 'Cyberpunk', ru: 'Киберпанк' }, value: 'Cyberpunk style' },
          { id: 'a3', label: { en: 'Surrealism', ru: 'Сюрреализм' }, value: 'Surrealism' },
          { id: 'a4', label: { en: 'Anime (90s)', ru: 'Аниме (90-е)' }, value: '90s anime style' },
          { id: 'a5', label: { en: 'Concept Art', ru: 'Концепт-арт' }, value: 'digital concept art' },
          { id: 'a6', label: { en: 'Vaporwave', ru: 'Вейпорвейв' }, value: 'Vaporwave aesthetic' },
          { id: 'a7', label: { en: 'Analog Horror', ru: 'Аналоговый хоррор' }, value: 'VHS analog horror' },
          { id: 'a8', label: { en: 'Noir', ru: 'Нуар' }, value: 'Film Noir' },
        ]
      },
      {
        id: 'extras', title: { en: 'EFFECTS (FX)', ru: 'ЭФФЕКТЫ (FX)' }, type: 'multi',
        options: [
          { id: 'e1', label: { en: 'Film Grain', ru: 'Зернистость' }, value: 'film grain' },
          { id: 'e2', label: { en: 'Chromatic Aberration', ru: 'Хроматика' }, value: 'chromatic aberration' },
          { id: 'e3', label: { en: 'Particles', ru: 'Частицы / Пыль' }, value: 'floating dust particles' },
          { id: 'e4', label: { en: 'Motion Blur', ru: 'Размытие движения' }, value: 'motion blur' },
          { id: 'e5', label: { en: 'Glitch', ru: 'Глитч' }, value: 'glitch effect' },
          { id: 'e6', label: { en: 'Vignette', ru: 'Виньетка' }, value: 'vignette' },
          { id: 'e7', label: { en: 'Bokeh', ru: 'Боке' }, value: 'bokeh' },
        ]
      }
    ];

    // --- STATE MANAGEMENT ---
    let lang = 'ru';
    let defaultState = {
      view: '',
      colors: '',
      size: '1000x1000',
      composition: [],
      light: [],
      textures: [],
      art: [],
      digital: [],
      extras: []
    };
    
    let state = JSON.parse(JSON.stringify(defaultState));
    let history = [];

    // --- RENDER FUNCTIONS ---
    function renderApp() {
      // 1. Text Labels
      document.getElementById('subtitle').innerText = UI_TEXT.subtitle[lang];
      document.getElementById('status-text').innerText = UI_TEXT.systemOnline[lang];
      document.getElementById('lbl-view').innerHTML = `<i data-lucide="terminal" class="w-4 h-4"></i> ${UI_TEXT.sceneLabel[lang]}`;
      document.getElementById('input-view').placeholder = UI_TEXT.scenePlaceholder[lang];
      document.getElementById('lbl-colors').innerHTML = `<i data-lucide="zap" class="w-4 h-4"></i> ${UI_TEXT.colorLabel[lang]}`;
      document.getElementById('input-colors').placeholder = UI_TEXT.colorPlaceholder[lang];
      document.getElementById('btn-generate').innerHTML = `<span>${UI_TEXT.generateBtn[lang]}</span> <i data-lucide="chevron-right" class="w-6 h-6"></i>`;
      document.getElementById('lbl-console').innerText = UI_TEXT.consoleTitle[lang];
      document.getElementById('txt-copy').innerText = UI_TEXT.copy[lang];
      document.getElementById('status-ready').innerText = UI_TEXT.statusReady[lang];
      document.getElementById('status-user').innerText = UI_TEXT.userAnon[lang];
      document.getElementById('lbl-reset').innerText = UI_TEXT.reset[lang];
      document.getElementById('lbl-presets').innerHTML = `<i data-lucide="layers" class="w-3 h-3"></i> ${UI_TEXT.presetsLabel[lang]}`;
      document.getElementById('lbl-history').innerText = UI_TEXT.historyLabel[lang];

      // Lang Switcher Styles
      const langEn = document.getElementById('lang-en');
      const langRu = document.getElementById('lang-ru');
      if (lang === 'en') {
        langEn.className = 'text-white font-bold';
        langRu.className = 'text-vbe-muted';
      } else {
        langEn.className = 'text-vbe-muted';
        langRu.className = 'text-white font-bold';
      }

      // 2. Render Presets
      const presetsContainer = document.getElementById('presets-container');
      presetsContainer.innerHTML = '';
      PRESETS.forEach(p => {
        const btn = document.createElement('button');
        btn.className = "flex flex-col items-center justify-center p-3 bg-black/40 border border-vbe-border hover:border-vbe-red hover:bg-vbe-red/10 rounded transition-all cursor-pointer group";
        btn.innerHTML = `
            <i data-lucide="${p.icon}" class="w-5 h-5 mb-1 text-vbe-muted group-hover:text-vbe-red transition-colors"></i>
            <span class="text-[10px] uppercase font-mono text-center leading-tight group-hover:text-white transition-colors">${p.name[lang]}</span>
        `;
        btn.onclick = () => applyPreset(p);
        presetsContainer.appendChild(btn);
      });

      // 3. Render Categories
      const container = document.getElementById('categories-container');
      container.innerHTML = ''; // Clear

      CATEGORIES.forEach(cat => {
        const section = document.createElement('div');
        section.className = "mb-6 p-5 bg-vbe-panel border border-vbe-border rounded-lg shadow-sm hover:border-vbe-red/40 transition-all duration-300 group";
        
        const header = document.createElement('h3');
        header.className = "text-sm font-bold mb-4 text-vbe-muted flex items-center gap-2 uppercase tracking-[0.2em] group-hover:text-vbe-red transition-colors";
        header.innerHTML = `<span class="w-2 h-2 bg-vbe-red rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></span>${cat.title[lang]}`;
        section.appendChild(header);

        const grid = document.createElement('div');
        grid.className = "grid grid-cols-2 md:grid-cols-4 gap-3";

        cat.options.forEach(opt => {
          const btn = document.createElement('button');
          const isSelected = isOptionSelected(cat.id, opt.value);
          
          btn.className = `relative flex items-center justify-start gap-2 p-3 text-xs md:text-sm font-medium rounded border transition-all duration-200 cursor-pointer ${
            isSelected 
            ? 'btn-selected' 
            : 'bg-black/40 text-vbe-text border-vbe-border hover:border-vbe-muted hover:bg-white/5'
          }`;
          
          btn.innerHTML = `
            <div class="w-3 h-3 rounded-full border flex items-center justify-center ${isSelected ? 'border-white' : 'border-vbe-muted'}">
              ${isSelected ? '<div class="w-1.5 h-1.5 bg-white rounded-full"></div>' : ''}
            </div>
            <span class="text-left leading-tight font-mono">${opt.label[lang]}</span>
          `;
          
          btn.onclick = () => toggleOption(cat.id, opt.value, cat.type === 'multi');
          grid.appendChild(btn);
        });

        section.appendChild(grid);
        container.appendChild(section);
      });

      // 4. Render History
      renderHistory();

      // Refresh icons
      lucide.createIcons();
    }

    // --- LOGIC ---
    function isOptionSelected(catId, value) {
      if (catId === 'size') return state.size === value;
      return state[catId] && state[catId].includes(value);
    }

    function toggleOption(catId, value, isMulti) {
      if (catId === 'size') {
        state.size = value;
      } else {
        if (!isMulti) return; 
        const idx = state[catId].indexOf(value);
        if (idx > -1) {
          state[catId].splice(idx, 1);
        } else {
          state[catId].push(value);
        }
      }
      renderApp();
    }

    function applyPreset(preset) {
        // Overlay preset data onto state
        state = { ...JSON.parse(JSON.stringify(defaultState)), ...preset.data };
        
        // Update input fields
        document.getElementById('input-view').value = state.view;
        document.getElementById('input-colors').value = state.colors;
        
        // Update selection UI
        renderApp();
    }

    function generatePrompt() {
      // Read current input values into state before generating
      state.view = document.getElementById('input-view').value;
      state.colors = document.getElementById('input-colors').value;

      const parts = [
        state.view ? `VIEW: ${state.view}` : '',
        state.colors ? `COLORS: ${state.colors}` : '',
        state.composition.length ? `COMPOSITION: ${state.composition.join(', ')}` : '',
        state.light.length ? `LIGHT: ${state.light.join(', ')}` : '',
        state.textures.length ? `TEXTURES: ${state.textures.join(', ')}` : '',
        state.art.length ? `STYLE: ${state.art.join(', ')}` : '',
        state.extras.length ? `EFFECTS: ${state.extras.join(', ')}` : '',
        state.size ? `SIZE: ${state.size}` : '',
      ].filter(Boolean);

      const final = `Create an image.\n\n${parts.join('\n')}`;
      
      const output = document.getElementById('output-result');
      output.value = final;
      
      // Save to history
      if (final.trim().length > 20) {
        addToHistory(final);
      }
      
      const copyBtn = document.getElementById('btn-copy');
      if (final.trim()) copyBtn.classList.remove('hidden');
    }

    // --- HISTORY MANAGEMENT ---
    function addToHistory(text) {
        // Prevent duplicates at the top
        if (history.length > 0 && history[0] === text) return;
        
        history.unshift(text);
        if (history.length > 10) history.pop(); // Keep last 10
        
        localStorage.setItem('vbe_history_v3', JSON.stringify(history));
        renderHistory();
    }

    function loadHistory() {
        const saved = localStorage.getItem('vbe_history_v3');
        if (saved) {
            try {
                history = JSON.parse(saved);
            } catch (e) {
                console.error("Failed to load history", e);
                history = [];
            }
        }
    }

    function clearHistory() {
        history = [];
        localStorage.removeItem('vbe_history_v3');
        renderHistory();
    }

    function renderHistory() {
        const container = document.getElementById('history-container');
        if (!container) return;
        
        container.innerHTML = '';
        if (history.length === 0) {
            container.innerHTML = `<div class="text-center py-4 text-vbe-muted text-xs italic opacity-50">Empty</div>`;
            return;
        }

        history.forEach((text) => {
            const item = document.createElement('div');
            item.className = "p-2 bg-vbe-panel border border-vbe-border hover:border-vbe-muted rounded text-[10px] font-mono text-vbe-muted hover:text-white cursor-pointer transition-all flex justify-between gap-2 group";
            
            const truncateText = text.replace(/Create an image.\n\n/g, '').substring(0, 40) + '...';
            
            item.innerHTML = `
                <span class="opacity-70 group-hover:opacity-100">${truncateText}</span>
                <i data-lucide="arrow-up-circle" class="w-3 h-3 text-vbe-red opacity-0 group-hover:opacity-100 transition-opacity"></i>
            `;
            item.onclick = () => {
                document.getElementById('output-result').value = text;
                const copyBtn = document.getElementById('btn-copy');
                copyBtn.classList.remove('hidden');
            };
            container.appendChild(item);
        });
        
        lucide.createIcons();
    }

    function resetApp() {
      state = JSON.parse(JSON.stringify(defaultState));
      document.getElementById('input-view').value = '';
      document.getElementById('input-colors').value = '';
      document.getElementById('output-result').value = '';
      document.getElementById('btn-copy').classList.add('hidden');
      renderApp();
    }

    // --- INIT ---
    // Load history from local storage on startup
    loadHistory();

    document.getElementById('lang-btn').onclick = () => {
      lang = lang === 'en' ? 'ru' : 'en';
      renderApp();
    };

    document.getElementById('btn-generate').onclick = generatePrompt;
    document.getElementById('btn-reset').onclick = resetApp;
    document.getElementById('btn-clear-history').onclick = clearHistory;

    document.getElementById('btn-copy').onclick = () => {
      const output = document.getElementById('output-result');
      output.select();
      navigator.clipboard.writeText(output.value);
      
      const txt = document.getElementById('txt-copy');
      const original = txt.innerText;
      txt.innerText = UI_TEXT.copied[lang];
      setTimeout(() => txt.innerText = original, 2000);
    };

    // Initial Render
    renderApp();
  </script>
</body>
</html>
